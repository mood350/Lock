{% extends "admin/baseadmin.html" %}
{% load i18n %}

{% block title %}{% trans "Admin" %} - {% trans "Transactions" %}{% endblock %}

{% block content %}
<div class="container mx-auto mt-8 px-4 max-w-7xl">
    <h2 class="text-3xl font-bold mb-6 text-primary">{% trans "Gestion des transactions" %}</h2>
    <div class="card bg-base-100 shadow-xl rounded-lg">
        <div class="card-body">
            {% if transactions %}
            <div class="overflow-x-auto rounded-lg border border-base-300">
                <table class="table w-full bg-base-100 table-zebra">
                    <thead>
                        <tr class="bg-primary text-primary-content uppercase text-sm">
                            <th class="px-4 py-4 text-left">{% trans "Date" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Client" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Type" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Crypto" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Quantité" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Montant" %}</th>
                            <th class="px-4 py-4 text-left">{% trans "Statut" %}</th>
                            <th class="px-4 py-4 text-center">{% trans "Actions" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in transactions %}
                        <tr class="hover:bg-base-200 transition-colors duration-150">
                            <td class="px-4 py-4">{{ t.timestamp|date:"d/m/Y H:i" }}</td>
                            <td class="px-4 py-4">
                                {{ t.user.username }}
                            </td>
                            <td class="px-4 py-4">
                                {% if t.transaction_type == "BUY" %}
                                    <span class="badge badge-success">{% trans "Achat" %}</span>
                                {% elif t.transaction_type == "SELL" %}
                                    <span class="badge badge-error">{% trans "Vente" %}</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-4">{{ t.crypto.nom }}</td>
                            <td class="px-4 py-4">{{ t.amount_crypto }}</td>
                            <td class="px-4 py-4">{{ t.amount_fcfa }} FCFA</td>
                            <td class="px-4 py-4">
                                {% if t.status == 'APPROVED' %}
                                    <span class="badge badge-success">{% trans "Approuvé" %}</span>
                                {% elif t.status == 'CANCELLED' or t.status == 'FAILED' %}
                                    <span class="badge badge-error">{% trans "Rejeté" %}</span>
                                {% else %}
                                    <span class="badge badge-warning">{% trans "En attente" %}</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-4 text-center space-x-2">
                                <a href="{% url 'valider_transaction' t.id %}" class="btn btn-xs btn-success hover:bg-success-focus transition-colors duration-200"
                                   onclick="return confirm('{% trans "Valider cette transaction ?" %}');">{% trans "Valider" %}</a>
                                <a href="{% url 'rejeter_transaction' t.id %}" class="btn btn-xs btn-error hover:bg-error-focus transition-colors duration-200"
                                   onclick="return confirm('{% trans "Rejeter cette transaction ?" %}');">{% trans "Rejeter" %}</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="text-center py-4">{% trans "Aucune transaction trouvée." %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info text-center font-semibold text-lg">
                {% trans "Aucune transaction trouvée." %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
