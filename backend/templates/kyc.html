{% extends "dashboard/base.html" %}
{% load i18n %}

{% block title %}{% trans "Vérification KYC" %} - Lock Exchange{% endblock %}

{% block content %}
<div class="container mx-auto mt-8 px-4 max-w-2xl">
    <h1 class="text-3xl font-bold mb-6 text-center">{% trans "Vérification KYC" %}</h1>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            {% if kyc and kyc.statut != 'en_attente' %}
            <div class="alert mb-4 {% if kyc.statut == 'valide' %}alert-success{% else %}alert-error{% endif %}">
                <i class="fas
                {% if kyc.statut == 'valide' %}fa-check-circle
                {% else %}fa-times-circle{% endif %} mr-2"></i>
                <span>
                    {% trans "Statut :" %}
                    <span class="font-semibold">
                        {{ kyc.get_statut_display }}
                    </span>
                    {% if kyc.date_validation %}
                    <br />{% trans "Date de validation :" %} {{ kyc.date_validation|date:"d/m/Y" }}
                    {% endif %}
                </span>
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                
                {% for field in form %}
                    <div class="form-control w-full">
                        <label class="label" for="{{ field.id_for_label }}">
                            <span class="label-text font-semibold">{{ field.label }}</span>
                        </label>
                        
                        {% if field.widget_type == "text" or field.widget_type == "date" %}
                            <input type="{{ field.widget_type }}"
                                   name="{{ field.name }}" 
                                   id="{{ field.id_for_label }}"
                                   class="input input-bordered w-full"
                                   value="{{ field.value|default:'' }}"
                                   {% if field.field.required %}required{% endif %}>
                        {% elif field.widget_type == "textarea" %}
                            <textarea name="{{ field.name }}" 
                                      id="{{ field.id_for_label }}"
                                      class="textarea textarea-bordered h-24 w-full" 
                                      {% if field.field.required %}required{% endif %}>{{ field.value|default:'' }}</textarea>
                        {% elif field.widget_type == "clearablefileinput" %}
                            <input type="file"
                                   name="{{ field.name }}" 
                                   id="{{ field.id_for_label }}"
                                   class="file-input file-input-bordered w-full" 
                                   {% if field.field.required %}required{% endif %}>
                        {% else %}
                            <!-- Fallback for other field types, if any -->
                            {{ field }}
                        {% endif %}

                        {% if field.help_text %}
                        <label class="label">
                            <span class="label-text-alt text-gray-500">{{ field.help_text }}</span>
                        </label>
                        {% endif %}
                        {% for error in field.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ error }}</span>
                        </label>
                        {% endfor %}
                    </div>
                {% endfor %}

                <button type="submit" class="btn btn-primary btn-block mt-6">{% trans "Soumettre" %}</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
